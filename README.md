# Тестовое задание: Сервис обмена мгновенными сообщениями

### Описание проекта:
Проект представляет собой реферальную систему с использованием FastAPI и PostgreSQL.
В рамках проекта реализованы следующие функции:
- Регистрация и аутентификация пользователей (JWT, OAuth 2.0)
- Получение информации о текущем пользователе
- Общение между пользователями в реально времени
- Просмотр истории сообщений между двумя пользователями
- Уведомление в телеграм если пользователь не в сети


## Настройка проекта
Для работы проекта необходимо создать файл `.env` в корневом каталоге проекта и задать следующие переменные окружения:

- `DATABASE_URL=<URL для подключения к базе данных Postgres>`. По умолчанию: `postgresql+asyncpg://postgres:postgres@db:5432/message_service`
- `SECRET_KEY=<Секретный ключ для подписывания JWT токенов>`. По умолчанию: `secret-key`
- `ALGORITHM=<HS256>`. По умолчанию: `HS256`
- `ACCESS_TOKEN_EXPIRE_MINUTES=<Время жизни токена (в минутах)>`. По умолчанию: `30`
- `REDIS_BROKER_URL=<URl брокера сообщений>`. По умолчанию: `redis://redis:6379/0`
- `BOT_TOKEN=<Токен Вашего telegram бота>`. Получить можно [здесь](https://t.me/BotFather)

Большинство переменных окружения уже имеют значения по умолчанию, которые находятся в файле `settings.py`.  
Однако для получения уведомлений в telegram необходимо обязательно задать переменную `BOT_TOKEN`.  


## Установка и запуск проекта при помощи Docker

1. **Клонируйте репозиторий на свой компьютер.**
```bash
git clone https://github.com/32Aleksey32/message_service.git
```
2. **Перейдите в папку с проектом.**
```
cd message_service/
```
3. **Запустите процесс создания и запуск контейнеров.**
```
docker-compose up --build
```
4. **Перейдите по адресу**
```
http://127.0.0.1:8000
```


### Дополнительно
Общение по API через WebSocket работает в формате JSON:
```json
{
  "sender": "example_user",
  "message": "example_message"
}
``` 

Для аутентификации отправителя передаем в заголовок cookie:
```
Cookie: access_token="your_access_token"
```


## Стек технологий
- Python 3.10
- FastAPI
- PostgreSQL
- SQLAlchemy
- Alembic
- Docker & Docker Compose
- Asyncio
- Aiogram
- Websocket
- Celery
- Redis